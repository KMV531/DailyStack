# .github/workflows/import-cron.yml

name: Scheduled Sanity CMS Import

# 1. Define the Schedule (Runs every 6 hours)
on:
  schedule:
    # Cron syntax: '0 */6 * * *' means: At minute 0, every 6th hour.
    - cron: "0 */6 * * *"

  # Allow manual testing from the GitHub Actions UI
  workflow_dispatch:

jobs:
  run_data_import:
    runs-on: ubuntu-latest # Use a standard GitHub runner environment

    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v4

      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: "20" # Specify a modern Node.js version

      - name: Install Project Dependencies
        # Use 'npm ci' for clean, consistent installs in CI/CD environments
        run: npm install

      # 2. Run the Script with Secrets
      - name: Execute Sanity Data Import
        env:
          # Inject the secrets stored in GitHub into the environment variables
          # that your ts-node script (process.env) expects to read.
          NEXT_PUBLIC_SANITY_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_SANITY_PROJECT_ID }}
          NEXT_PUBLIC_SANITY_DATASET: ${{ secrets.NEXT_PUBLIC_SANITY_DATASET }}
          SANITY_API_TOKEN: ${{ secrets.NEXT_PUBLIC_SANITY_API_TOKEN }}

        run: npm run import-nextjs # Executes the command defined in package.json
